<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_transform_script">
    <sys_transform_script action="INSERT_OR_UPDATE">
        <active>true</active>
        <map display_value="Operation Replay">c2710983dbd620101752b298f4961982</map>
        <order>100</order>
        <script><![CDATA[(function runTransformScript(source, map, log, target /*undefined onStart*/ ) {

    var gdt = new GlideDateTime(source.u_date_time),
        dt_sys_id,
        R_WDOFUT = 'fdeeb483dbd620101752b298f496194e',
        STRATEGY = '3eb8ecd3db0620101752b298f4961985'; // Not mapped;

    var date = gdt.getDate();
    date = date.toString();

    var gr_dt = new GlideRecord('x_200145_trade_sa_day_trade');
    gr_dt.addEncodedQuery("account_type=simulator^dateON" + date + "@javascript:gs.dateGenerate('" + date + "','start')@javascript:gs.dateGenerate('" + date + "','end')");
    gr_dt.addQuery("trade_asset", R_WDOFUT);
    gr_dt.orderBy('date');
    gr_dt.setLimit(1);
    gr_dt.query();
    if (gr_dt.next()) {

        dt_sys_id = gr_dt.getUniqueValue();

        var gr_op = new GlideRecord('x_200145_trade_sa_operation');
        gr_op.addQuery("day_trade", dt_sys_id);
        gr_op.addEncodedQuery("sys_created_onNOTONToday@javascript:gs.beginningOfToday()@javascript:gs.endOfToday()");
        gr_op.deleteMultiple();


    } else {
        var gr_dt2 = new GlideRecord('x_200145_trade_sa_day_trade');
        gr_dt2.newRecord();
        gr_dt2.date = date;
        gr_dt2.account_type = 'simulator';
        gr_dt2.trade_asset = R_WDOFUT;
        gr_dt2.imported = true;
        dt_sys_id = gr_dt2.insert();
    }

    if (source.u_contract_s_ == 1) {
        target.realization = 'Full';
    } else {
        target.realization = 'Partial';
    }

    var gr_stg = new GlideRecord('x_200145_trade_sa_strategy');
    gr_stg.addEncodedQuery("entry_code!=NULL");
    gr_stg.addQuery('entry_code', source.u_strategy);
    gr_stg.orderBy('number');
    gr_stg.setLimit(1);
    gr_stg.query();

    if (gr_stg.next()) {

        STRATEGY = gr_stg.getUniqueValue();

    }
    //log.info('PETERSON ' + strategy);
    target.strategy = STRATEGY;
    target.day_trade = dt_sys_id;
    target.imported = true;
    target.men = parseFloat(source.u_men);

})(source, map, log, target);]]></script>
        <sys_class_name>sys_transform_script</sys_class_name>
        <sys_created_by>peterson.ferreira</sys_created_by>
        <sys_created_on>2021-02-17 12:16:02</sys_created_on>
        <sys_id>dfb10183dbd620101752b298f49619ca</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_name>onBefore</sys_name>
        <sys_package display_value="Trade Performance" source="x_200145_trade_sa">627f7d43db30201024e058b3ca961958</sys_package>
        <sys_policy/>
        <sys_scope display_value="Trade Performance">627f7d43db30201024e058b3ca961958</sys_scope>
        <sys_update_name>sys_transform_script_dfb10183dbd620101752b298f49619ca</sys_update_name>
        <sys_updated_by>peterson.ferreira</sys_updated_by>
        <sys_updated_on>2021-02-17 12:30:37</sys_updated_on>
        <when>onBefore</when>
    </sys_transform_script>
</record_update>
